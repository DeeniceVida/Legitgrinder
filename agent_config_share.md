# Project Configuration Share

This file contains the core configuration and type definitions for the `copy-of-legitgrinder` project. Use this for a seamless transition to the new design.

## package.json
```json
{
  "name": "copy-of-legitgrinder",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@google/genai": "^1.38.0",
    "@supabase/supabase-js": "^2.91.1",
    "lucide-react": "^0.563.0",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "recharts": "^3.7.0"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}
```

## vite.config.ts
```typescript
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, '.', '');
  return {
    server: {
      port: 3000,
      host: '0.0.0.0',
    },
    plugins: [react()],
    define: {
      // 'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY), // Removed for security
    },
    resolve: {
      alias: {
        '@': path.resolve(__dirname, '.'),
      }
    }
  };
});
```

## tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}
```

## .env.local (Environment Variable Structure)
```env
GEMINI_API_KEY=PLACEHOLDER_API_KEY
VITE_SUPABASE_URL=https://birypkfferkwukogyhnb.supabase.co
VITE_SUPABASE_ANON_KEY=sb_publishable_hDYAa8ljlY83Xmnf7xlc3Q_mA4cL7A0
```

## supabase/schema.sql
```sql
-- Create a table for products (phones)
create table products (
  id bigint generated by default as identity primary key,
  brand text not null, -- 'iphone' | 'samsung' | 'pixel'
  name text not null,
  series text not null,
  capacities text[] not null, -- Array of strings e.g. ['64GB', '128GB']
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create a table for global app settings (fees, currency, etc.)
create table app_settings (
  id bigint generated by default as identity primary key,
  key text unique not null,
  value jsonb not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Enable Row Level Security (RLS)
alter table products enable row level security;
alter table app_settings enable row level security;

-- Create policies to allow public read access
create policy "Allow public read access" on products for select using (true);
create policy "Allow public read access" on app_settings for select using (true);

-- Insert initial settings placeholders (will be updated by seed script)
insert into app_settings (key, value)
values 
  ('KES_PER_USD', '135'::jsonb),
  ('WHATSAPP_NUMBER', '"254791873538"'::jsonb), -- JSON string
  ('AUTOMATION_SETTINGS', '{"CYCLE_DAYS": 21, "MAX_PER_DAY": 15, "DELAY_MINUTES": 2, "OPERATING_HOURS": {"START": 9, "END": 18}, "SKIP_WEEKENDS": true}'::jsonb),
  ('FEE_STRUCTURE', '{"FIXED_USD": 8, "SHIPPING_FLAT_USD": 20, "SHIPPING_PERCENT": 0.035, "SERVICE_FEE_FIXED_USD": 30, "SERVICE_FEE_PERCENT_LARGE": 0.045, "THRESHOLD_USD": 750}'::jsonb)
on conflict (key) do nothing;
```

## constants.ts
```typescript
import { ShippingMode, Origin, OrderStatus } from './types';

export const KES_PER_USD = 135;
export const WHATSAPP_NUMBER = '254791873538';

export const PHONE_MODELS_SCHEMA = {
  iphone: [
    { name: 'iPhone 11', capacities: ['64GB', '128GB', '256GB'], series: '11 Series' },
    { name: 'iPhone 11 Pro', capacities: ['64GB', '256GB', '512GB'], series: '11 Series' },
    // ... (truncated for brevity, contains all iPhone, Samsung, and Pixel models)
  ],
  // ... samsung and pixel schemas
};

export const AUTOMATION_SETTINGS = {
  CYCLE_DAYS: 21,
  MAX_PER_DAY: 15,
  DELAY_MINUTES: 2,
  OPERATING_HOURS: { START: 9, END: 18 },
  SKIP_WEEKENDS: true
};

export const FEE_STRUCTURE = {
  FIXED_USD: 8,
  SHIPPING_FLAT_USD: 20,
  SHIPPING_PERCENT: 0.035,
  SERVICE_FEE_FIXED_USD: 30,
  SERVICE_FEE_PERCENT_LARGE: 0.045,
  THRESHOLD_USD: 750
};

export const STATUS_SEQUENCE = [
  OrderStatus.RECEIVED_BY_AGENT,
  OrderStatus.LEFT_WAREHOUSE,
  OrderStatus.SHIPPING,
  OrderStatus.LANDED_CUSTOMS,
  OrderStatus.EN_ROUTE_NAIROBI,
  OrderStatus.READY_FOR_COLLECTION
];
```

## types.ts
```typescript
export enum ShippingMode {
  AIR = 'Air',
  SEA = 'Sea'
}

export enum Origin {
  CHINA = 'China',
  USA = 'USA'
}

export enum OrderStatus {
  RECEIVED_BY_AGENT = 'Received by Agent',
  LEFT_WAREHOUSE = 'Left Warehouse',
  SHIPPING = 'Now Shipping',
  LANDED_CUSTOMS = 'Landed & In Customs',
  EN_ROUTE_NAIROBI = 'En route to Nairobi',
  READY_FOR_COLLECTION = 'Ready to Collect'
}

export interface Product {
  id: string;
  name: string;
  priceKES: number;
  discount_price?: number;
  inventory_quantity: number;
  variations: string[];
  colors: string[];
  buyingPriceKES?: number;
  shippingFeeKES?: number;
  serviceFeeKES?: number;
  origin: Origin;
  category: string;
  image: string;
  description: string;
  stockStatus: 'In Stock' | 'Import on Order';
}

export interface CapacityPrice {
  capacity: string;
  sourcePriceUSD: number | null;
  currentPriceKES: number;
  previousPriceKES: number;
  lastSynced: string;
  isManualOverride: boolean;
}

export interface ProductVariant {
  id: number;
  product_id: number;
  capacity: string;
  source_url: string | null;
  price_usd: number | null;
  price_kes: number | null;
  last_updated: string | null;
  status: 'active' | 'out_of_stock' | 'error';
}

export interface PricelistItem {
  id: string;
  modelName: string;
  brand: 'iphone' | 'samsung' | 'pixel';
  series: string;
  capacities: CapacityPrice[];
  syncAlert: boolean;
  sourceUrl?: string;
}

export interface Order {
  id: string;
  clientName: string;
  clientPhone: string;
  clientEmail: string;
  clientLocation: string;
  productName: string;
  productUrl?: string;
  buyingPriceKES: number;
  shippingFeeKES: number;
  serviceFeeKES: number;
  totalCostKES: number;
  status: OrderStatus;
  mode: ShippingMode;
  origin: Origin;
  datePlaced: string;
  isPaid: boolean;
  weightKg?: number;
  dimensions?: string; // e.g., "10x20x30 cm"
}

export interface CalculationResult {
  buyingPriceKES: number;
  shippingFeeKES: number;
  serviceFeeKES: number;
  totalKES: number;
}
```
